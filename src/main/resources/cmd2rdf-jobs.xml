<?xml version="1.0" encoding="UTF-8"?>
<CMD2RDF>
    <config version="1.0">
        <properties>
            <property name="homedir">/Users/akmi/eko-cmdi-test</property>
            <property name="harvestedProfilesDir">{homedir}/harvester</property>
            <property name="xsltSourceDir">{homedir}/xsl</property>
            <property name="xmlSourceDir">{homedir}/xml-data</property>
            <property name="urlDB">{homedir}/db/DB_CMD_CHECKSUM</property>
            <property name="profilesCacheDir">{homedir}/profiles-cache</property>
            <property name="registry">http://catalog.clarin.eu/ds/ComponentRegistry</property>
            <property name="rdfStoreServerURL">localhost:8000/sparql-graph-crud-auth?</property>
            <property name="rdfStoreUsername">dba</property>
            <property name="rdfStorePass">dba</property>
        </properties>
    </config>
    <prepare>
        <actions>
            <action name="checksum">
                <class name="nl.knaw.dans.clarin.cmd2rdf.store.db.MD5ChecksumDBAction">
                    <properties>
                        <property name="xmlSourceDir">{xmlSourceDir}</property>
                        <property name="urlDB">{urlDB}</property>
                        <property name="action">CHECKSUM DIFF</property>
                    </properties>
                </class>
            </action>
            <action name="fetch">
                <class name="nl.knaw.dans.clarin.cmd2rdf.harvester.OaipmhHarvester">
                    <properties>
                        <property name="oaipmhBaseURL">https://openskos.meertens.knaw.nl/oai-pmh</property>
                        <property name="prefix">oai_rdf</property>
                        <property name="set">meertens:VLO-orgs</property>
                        <property name="outputFile">{harvestedProfilesDir}/meertens-VLO-orgs.rdf</property>
                    </properties>
                </class>
            </action>
            <action>  
                <class name="nl.knaw.dans.clarin.cmd2rdf.store.db.MD5ChecksumDBAction">
                    <properties>
                        <property name="urlDB">{urlDB}</property>
                        <property name="action">DELETE</property>
                    </properties>
                </class>
            </action>
        </actions>
    </prepare>
    <records>
        <record filter="NEW UPDATE" nThreads="2" xmlSource="{urlDB}" >
            <actions>
                <action name="transform">
                    <class name="nl.knaw.dans.clarin.cmd2rdf.mt.XsltTransformer">
                        <properties>
                            <property name="xsltSource">{xsltSourceDir}/CMDRecord2RDF.xsl</property>
                            <property name="baseStripParam">{xmlSourceDir}</property>
                            <property name="baseURIParam">http://localhost:8888/DAV</property>
                        </properties>
                    </class>
                </action>
                <action>
                    <class name="nl.knaw.dans.clarin.cmd2rdf.mt.XsltTransformer">
                        <properties>
                            <property name="xsltSource">{xsltSourceDir}/addOrganisationEntity.xsl</property>
                            <property name="VLO-orgs">{homedir}/harvester/meertens-VLO-orgs.rdf</property>
                        </properties>
                    </class>
                </action>
                <action>
                    <class name="nl.knaw.dans.clarin.cmd2rdf.store.VirtuosoClient">
                        <properties>
                            <property name="replacedPrefixBaseURI">{xmlSourceDir}</property>
                            <property name="prefixBaseURI">http://localhost:8888/DAV</property>
                            <property name="serverURL">http://localhost:8000/sparql-graph-crud-auth?</property>
                            <property name="username">dba</property>
                            <property name="password">dba</property>
                            <property name="action">POST</property>
                        </properties>
                    </class>
                </action>
                <action>
                    <class name="nl.knaw.dans.clarin.cmd2rdf.store.db.MD5ChecksumRecordStatus">
                        <properties>
                            <property name="urlDB">{urlDB}</property>
                            <property name="action">UPDATE</property>
                            <property name="status">DONE</property>
                        </properties>
                    </class>
                </action>
            </actions>
        </record>
        <record filter="DELETE" xmlSource="{urlDB}" >
            <actions>
                <action>
                    <class name="nl.knaw.dans.clarin.cmd2rdf.store.VirtuosoClient">
                        <!-- DELETE the Virtuoso named graph for removed CMDI records -->
                        <properties>
                            <property name="replacedPrefixBaseURI">{xmlSourceDir}</property>
                            <property name="prefixBaseURI">http://localhost:8888/DAV</property>
                            <property name="serverURL">http://localhost:8000/sparql-graph-crud-auth?</property>
                            <property name="username">dba</property>
                            <property name="password">dba</property>
                            <property name="action">DELETE</property>
                        </properties>
                    </class>
                </action>
                <action>
                    <class name="nl.knaw.dans.clarin.cmd2rdf.store.db.MD5ChecksumRecordStatus">
                        <properties>
                            <property name="urlDB">{urlDB}</property>
                            <property name="action">UPDATE</property>
                            <property name="status">PURGE</property>
                        </properties>
                    </class>
                </action>
            </actions>
        </record>
    </records>
    <cleanup>
        <actions>
            <action>
                <class name="nl.knaw.dans.clarin.cmd2rdf.store.db.MD5ChecksumDBAction">
                    <properties>
                        <property name="urlDB">{urlDB}</property>
                        <property name="action">CLEANUP </property>
                    </properties>
                </class>
            </action>
        </actions>
    </cleanup>
</CMD2RDF>